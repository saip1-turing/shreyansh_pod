name: Validate Single JSON Change

on:
  pull_request:
    types: [opened, labeled, unlabeled, synchronize, reopened]
    branches:
      - main
      - workflows_LLM

jobs:
  validate-json-change:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Get changed files from the PR via GitHub API
      - name: Get changed files in PR
        id: changed-files
        uses: tj-actions/changed-files@v46
        with:
          files: '**/*.json' # Only consider JSON files

      # Validate exactly one JSON file changed
      - name: Validate only one JSON file changed
        run: |
          JSON_FILES="${{ steps.changed-files.outputs.all_changed_files }}"
          COUNT=$(echo "$JSON_FILES" | tr ' ' '\n' | grep -c . || true)

          echo "🔍 Changed JSON files:"
          echo "$JSON_FILES" | tr ' ' '\n'

          if [[ "$COUNT" -ne 1 ]]; then
            echo "❌ PR must change exactly one JSON file. Found $COUNT."
            exit 1
          fi

          FILE_PATH=$(echo "$JSON_FILES" | tr ' ' '\n' | head -n 1)
          echo "✅ Passed: $FILE_PATH"
          echo "file_path=$FILE_PATH" >> $GITHUB_ENV

      # Example: Use the file in next step
      - name: Process JSON file
        run: |
          echo "Processing file: $file_path"
          cat "$file_path"
