name: Validate Single JSON Change

on:
  pull_request:
    types: [opened, labeled, unlabeled, synchronize, reopened]
    branches:
      - main
      - automate_actions

jobs:
  validate-json-change:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@ed68ef82c095e0d48ec87eccea555d944a631a4c # v46.0.1

      - name: Validate only one .json file changed
        run: |
          FILES="${{ steps.changed-files.outputs.all_changed_files }}"
          # Split by space
          read -ra FILE_ARRAY <<< "$FILES"
          COUNT=${#FILE_ARRAY[@]}
          
          echo "🔍 Found $COUNT changed file(s):"
          printf '%s\n' "${FILE_ARRAY[@]}"
          
          if [[ "$COUNT" -ne 1 ]]; then
            echo "❌ PR must change exactly one file. Found $COUNT."
            exit 1
          fi
          
          FILE="${FILE_ARRAY[0]}"
          if [[ "${FILE}" != *.json ]]; then
            echo "❌ File is not a .json file: $FILE"
            exit 1
          fi
          
          echo "✅ Passed: Exactly one .json file changed: $FILE"
     
